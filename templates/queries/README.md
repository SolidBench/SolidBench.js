# Query templates

The `short` and `complex` queries within this directory are based on the [`interactive-` queries of SNB](https://github.com/ldbc/ldbc_snb_interactive_impls/tree/c19be0e793680497de4e88d360a20708cfcf43a9/sparql/queries).
Queries are slightly modified to be based on IRI-based parameters instead of id/integer-based parameters,
as the former is better suitable for decentralized environments.
Non-SPARQL queries have been omitted.

The choke points that were used to determine the discover queries can be found at https://github.com/SolidBench/SolidBench.js/blob/master/docs/choke-points.md

Below, you can find an overview of these queries.
More details can be found in https://arxiv.org/pdf/2001.02299.pdf

`discover` queries have been created specifically for testing discovery-related choke points in data vaults.

| Filename | Title | Parameter | Description |
| -------- | ----- | | --------- ----------- |
| `interactive-short-1.sparql` | Profile of a person | `person` | Given a start Person, retrieve their first name, last name, birthday, IP address, browser, and city of residence. |
| `interactive-short-2.sparql` | Recent messages of a person | `person` | Given a start Person, retrieve the last 10 Messages created by that user. For each Message, return that Message, the original Post in its conversation (post), and the author of that Post (originalPoster). If any of the Messages is a Post, then the original Post (post) will be the same Message, i.e. that Message will appear twice in that result. |
| `interactive-short-3.sparql` | Friends of a person | `rootPerson` | Given a start Person, retrieve all of their friends, and the date at which they became friends. |
| `interactive-short-4.sparql` | Content of a message | `message` | Given a Message, retrieve its content and creation date. |
| `interactive-short-5.sparql` | Creator of a message | `message` | Given a Message, retrieve its author. |
| `interactive-short-6.sparql` | Forum of a message | `message` | Given a Message, retrieve the Forum that contains it and the Person that moderates that Forum. Since Comments are not directly contained in Forums, for Comments, return the Forum containing the original Post in the thread which the Comment is replying to. |
| `interactive-short-7.sparql` | Replies of a message | `message` | Given a Message, retrieve the (1-hop) Comments that reply to it. In addition, return a boolean flag knows indicating if the author of the reply (replyAuthor) knows the author of the original message (messageAuthor). If author is same as original author, return False for knows flag. |
| `interactive-complex-1.sparql`  | Transitive friends with certain name | `rootPerson`, `firstName`  | Given a start Person, find Persons with a given first name (firstName) that the start Person is connected to (excluding start Person) by at most 3 steps via the knows relationships. Return Persons, including the distance (1..3), summaries of the Persons workplaces and places of study. |
| `interactive-complex-2.sparql`  | Recent messages by your friends | `rootPerson`, `maxDate` | Given a start Person (person), find the most recent Messages from all of that Person’s friends (friend nodes). Only consider Messages created before the given maxDate (excluding that day). |
| `interactive-complex-3.sparql`  | Friends and friends of friends that have been to given countries | `rootPerson`, `countryXName`, `countryYName`, `startDate`, `durationDays` | Given a start Person, find Persons that are their friends and friends of friends (excluding start Person) that have made Posts / Comments in both of the given Countries, CountryX and CountryY, within a given period. Only Persons that are foreign to Countries CountryX and CountryY are considered, that is Persons whose location is neither CountryX nor CountryY. |
| `interactive-complex-4.sparql`  | New topics | `rootPerson`, `startDate`, `durationDays` | Given a start Person (personId), find Tags that are attached to Posts that were created by that Person’s friends. Only include Tags that were attached to friends’ Posts created within a given time interval, and that were never attached to friends’ Posts created before this interval. |
| `interactive-complex-5.sparql`  | New groups | `rootPerson`, `minDate` | Given a start Person, denote their friends and friends of friends (excluding the start Person) as otherPerson. Find Forums that any Person otherPerson became a member of after a given date (minDate). For each of those Forums, count the number of Posts that were created by the Person otherPerson. |
| `interactive-complex-6.sparql`  | Tag co-occurrence | `rootPerson`, `tagName` | Given a start Person and some Tag, find the other Tags that occur together with this Tag on Posts that were created by start Person’s friends and friends of friends (excluding start Person). Return top 10 Tags, and the count of Posts that were created by these Persons, which contain both this Tag and the given Tag. |
| `interactive-complex-7.sparql`  | Recent likers | `rootPerson` | Given a start Person, find the most recent likes on any of start Person’s Messages. Find Persons that liked (likes edge) any of start Person’s Messages, the Messages they liked most recently, the creation date of that like, and the latency in minutes (minutesLatency) between creation of Messages and like. Additionally, for each Person found return a flag indicating (isNew) whether the liker is a friend of start Person. In case that a Person liked multiple Messages at the same time, return the Message with lowest identifier. |
| `interactive-complex-8.sparql`  | Recent replies | `rootPerson` | Given a start Person, find the most recent Comments that are replies to Messages of the start Person. Only consider direct (single-hop) replies, not the transitive (multi-hop) ones. Return the reply Comments, and the Person that created each reply Comment. |
| `interactive-complex-9.sparql`  | Recent messages by friends or friends of friends | `rootPerson`, `maxDate` | Given a start Person, find the most recent Messages created by that Person’s friends or friends of friends (excluding start Person). Only consider Messages created before the given maxDate (excluding that day). |
| `interactive-complex-10.sparql` | Friend recommendation | `rootPerson`, `month` | Given a start Person with id personId, find that Person’s friends of friends (foaf) – excluding the start Person and his/her immediate friends –, who were born on or after the 21st of a given month (in any year) and before the 22nd of the following month. Calculate the similarity between each friend and the start person, where commonInterestScore is defined as follows: • common = number of Posts created by friend, such that the Post has a Tag that the start person is interested in • uncommon = number of Posts created by friend, such that the Post has no Tag that the start person is interested in • commonInterestScore = common - uncommon |
| `interactive-complex-11.sparql` | Job referral | `rootPerson`, `countryName`, `workFromYear` | Given a start Person, find that Person’s friends and friends of friends (excluding start Person) who started working in some Company in a given Country, before a given date (year). |
| `interactive-complex-12.sparql` | Expert search | `rootPerson`, `tagClassName` | Given a start Person, find the Comments that this Person’s friends made in reply to Posts, considering only those Comments that are direct (single-hop) replies to Posts, not the transitive (multi-hop) ones. Only consider Posts with a Tag in a given TagClass or in a descendent of that TagClass. Count the number of these reply Comments, and collect the Tags that were attached to the Posts they replied to, but only collect Tags with the given TagClass or with a descendant of that TagClass. Return Persons with at least one reply, the reply count, and the collection of Tags. |
| `interactive-discover-1.sparql` | All posts of a person | `person` | Given a start Person, retrieve their posts, and retrieve its message content, creation date, and message id. |
| `interactive-discover-2.sparql` | All messages of a person | `person` | Given a start Person, retrieve the union of their posts and messages, and retrieve its message content, creation date, and message id. |
| `interactive-discover-3.sparql` | Top tags in messages from a person | `person` | Given a start Person, find its messages, find its tags, and retrieve the tag names. Group everything by tag name, and count the messages grouped by tag name in descending order. |
| `interactive-discover-4.sparql` | Top locations in comments from a person | `person` | Given a start Person, find its comments, find its locations, and retrieve the location names. Group everything by location name, and count the messages grouped by location name in descending order. |
| `interactive-discover-5.sparql` | All IPs a person has messaged from | `person` | Given a start Person, find its messages, and retrieve the distinct location IPs of each message. |
| `interactive-discover-6.sparql` | All fora a person messaged on | `person` | Given a start Person, find its messages, find the forum each message is part of, and retrieve each forum id and title. |
| `interactive-discover-7.sparql` | All moderators in fora a person messaged on | `person` | Given a start Person, find its messages, find the forum each message is part of, find its moderators, and retrieve the moderator's first and last name. |
| `interactive-discover-8.sparql` | Other messages created by people that a person likes messages from | `person` | Given a start Person, find its likes, find the creator of the likes, find other messages by the creator, and retrieve messages contents. |
